#!/bin/sh -efu

if [ -n "${VM_USAGE-}" ]; then
	printf 'init\n'
	exit 0
fi

if [ -n "${VM_HELP-}" ]; then
	printf 'Initializes a home directory\n'
	exit 0
fi

if [ -n "${VM_HELP_OPTIONS-}" ]; then
	cat <<-EOF
	  --usage    shows the help message of subcommand.
	EOF
	exit 0
fi

GETOPT_ALLOW_UNKNOWN=
TEMP=`getopt -n $PROG -o '' -l 'usage' -- "$@"` ||
	show_usage
eval set -- "$TEMP"

while :; do
	case "$1" in
		--usage)
			show_command_help
			;;
		--) shift; break
			;;
	esac
	shift
done

. shell-error
. shell-git-config

mkdir $verbose -p -- "$HOME/vm"

if [ ! -f "$vm_config_file" ]; then
	message "Config file: $vm_config_file"
	:> "$vm_config_file"

	git_config_set "$vm_config_file" "vm.console" "serial"
	git_config_set "$vm_config_file" "vm.profiles" "$HOME/vm"
fi
