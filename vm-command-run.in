#!/bin/sh -efu

. shell-error
. shell-git-config

. "@PREFIX@/vm-sh-config"

debug_exec() {
	printf '%s \\\n' "$1"; shift
	opt=
	for a; do
		if [ -z "${a##-*}" ]; then
			[ -z "$opt" ] || printf '\\\n'
			printf '\t%s ' "$a"
			opt=1
		else
			printf '"%s" \\\n' "$a"
			opt=
		fi
	done
	printf '\t#\n'
}

git_config_location_exists "$vm_config_file" "vm.$vm_profile" ||
	fatal "Profile not exists: vm.$vm_profile"

vm_read_config "$vm_config_file"

${vm_dryrun:+debug_exec} \
$qemu_exec $qemu_args ${qemu_cmdline:+-append "$qemu_cmdline"}
